#!/usr/bin/env python3
import paramiko
import time

# Configuración de conexión
host = "192.168.1.100"     # Cambia por IP real del switch
usuario = "admin"
clave = "passw0rd"

# Crear cliente SSH
cliente = paramiko.SSHClient()
cliente.set_missing_host_key_policy(paramiko.AutoAddPolicy())
cliente.connect(hostname=host, username=usuario, password=clave, look_for_keys=False, allow_agent=False)

# Usar shell interactivo
shell = cliente.invoke_shell()
time.sleep(1)

# Limpiar buffer inicial
if shell.recv_ready():
    shell.recv(1000)

# Enviar cfgsave
shell.send("cfgsave\n")
time.sleep(2)

output = shell.recv(5000).decode('utf-8')
print(output)

# Verifica y responde a prompts
if "Do you want to save" in output:
    shell.send("y\n")
    time.sleep(1)

if "password:" in output.lower():
    shell.send(clave + "\n")
    time.sleep(2)

# Recoger la salida final
output += shell.recv(5000).decode('utf-8')
print(output)

# Cerrar sesión
shell.send("exit\n")
cliente.close()
